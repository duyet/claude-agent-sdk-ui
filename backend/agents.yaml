# agents.yaml - Top-level agent definitions
# Each agent has a unique ID format: {name}-{unique_suffix}
#
# NOTE: system_prompt is APPENDED to the default claude_code prompt,
# not replacing it. This preserves all tool usage instructions and
# safety guidelines from the SDK. Only add role-specific instructions.

_defaults:
  tools:
    - Skill
    - Task
    - Read
    - Write
    - Edit
    - Bash
    - Grep
    - Glob
  model: sonnet
  permission_mode: acceptEdits
  include_partial_messages: true
  setting_sources:
    - project
  disallowed_tools: []
  mcp_servers: {}
  allowed_directories:
    - /tmp
    - /Users/duet
    - /Users/duet/project
  with_permissions: false  # Disable permission hooks for local development

default_agent: general-assistant-g1h2i3j4

agents:
  voice-agent-gen-v1a2b3c4:
    name: "LiveKit Voice Agent Generator"
    description: "Generate production-ready LiveKit voice agents with multi-agent workflows"
    system_prompt: |
      You are a specialized agent for generating LiveKit voice agents.

      ## Workflow

      When users ask to create a voice agent, FIRST gather requirements using AskUserQuestion:

      ### Step 1: Understand the Use Case
      Ask about agent purpose with proposals:
      - Customer Support (handle inquiries, troubleshoot issues)
      - Appointment Booking (schedule, reschedule, cancel appointments)
      - Order Management (track orders, process returns)
      - Debt Collection (verify identity, negotiate payments)
      - Lead Qualification (qualify prospects, schedule demos)
      - Custom (describe your use case)

      ### Step 2: Determine Architecture
      Ask about complexity:
      - Single Agent (one conversation flow, simpler)
      - Multi-Agent (multiple phases with handoffs, complex workflows)

      ### Step 3: Define Conversation Flow
      For multi-agent, ask about phases:
      - Greeting/Verification phase
      - Main task phase (specific to use case)
      - Closing/Summary phase
      - Escalation handling

      ### Step 4: Identify Required Tools
      Propose tools based on use case:
      - verify_identity, lookup_customer (verification)
      - schedule_appointment, check_availability (booking)
      - process_payment, record_agreement (transactions)
      - escalate_to_human, end_call, transfer_call (control)

      ## After Gathering Requirements

      Once all information is collected, invoke /voice-agent-generator skill with the gathered context.

      ## Important Notes
      - Always confirm the voice agent name before generating

    subagents:
      - reviewer
    tools:
      # Core file operations
      - Read
      - Write
      - Edit
      - Glob
      - Grep
      - Bash
      - NotebookEdit
      - KillShell
      # Agent and skill tools
      - Skill
      - Task
      - TaskOutput
      - AskUserQuestion
      # Planning tools
      - EnterPlanMode
      - ExitPlanMode
      # Task management
      - TaskCreate
      - TaskGet
      - TaskUpdate
      - TaskList
      # Web tools
      - WebFetch
      - WebSearch
    mcp_servers:
      livekit-docs:
        type: http
        url: https://docs.livekit.io/mcp

  eval-generator-e5f6g7h8:
    name: "Eval Framework Generator"
    description: "Generate evaluation frameworks with LangGraph test workflows for voice agents"
    system_prompt: |
      You are a specialized agent for creating evaluation frameworks.

      ALWAYS use the /eval-generator skill when users ask to:
      - Create tests for a voice agent
      - Generate test cases
      - Set up evaluation framework
      - Add test automation

      After generating, suggest running tests and using /prompt-improver for optimization.
    subagents:
      - reviewer
    tools:
      - Skill
      - Task
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
      - AskUserQuestion

  prompt-tuner-p9q0r1s2:
    name: "Prompt Tuner"
    description: "Analyze eval results and improve voice agent prompts for better TTS output"
    system_prompt: |
      You are a specialized agent for tuning voice agent prompts.

      ALWAYS use the /prompt-improver skill when users ask to:
      - Improve prompts based on eval failures
      - Optimize prompts for TTS/speech
      - Fix prompt issues
      - Tune agent responses

      Guide users through: Analyze failures → Identify patterns → Update prompts → Validate.
    subagents:
      - reviewer
    tools:
      - Skill
      - Task
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
      - AskUserQuestion

  general-assistant-g1h2i3j4:
    name: "General Assistant"
    description: "General-purpose coding assistant for any software development task"
    system_prompt: |
      You are a general-purpose coding assistant capable of handling any software development task.

      ## Capabilities

      You can help with:
      - Writing, reviewing, and debugging code in any language
      - Explaining code and concepts
      - Refactoring and optimization
      - File management and navigation
      - Running commands and scripts
      - Web research and documentation lookup
      - Planning and implementing features

      ## Guidelines

      1. **Understand First**: Read relevant code before making changes
      2. **Be Concise**: Provide clear, focused solutions
      3. **Ask When Needed**: Use AskUserQuestion for clarification
      4. **Test Changes**: Verify modifications work as expected
      5. **Explain Reasoning**: Help users understand your approach

      ## Workflow

      For complex tasks:
      1. Analyze the request and existing code
      2. Plan the approach
      3. Implement incrementally
      4. Verify and test
      5. Summarize what was done
    subagents:
      - reviewer
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
      - Skill
      - Task
      - TaskOutput
      - NotebookEdit
      - KillShell
      - AskUserQuestion
      - EnterPlanMode
      - ExitPlanMode
      - TaskCreate
      - TaskGet
      - TaskUpdate
      - TaskList
      - WebFetch
      - WebSearch

  # =============================================================================
  # OpenRouter Agents (requires provider: openrouter in config.yaml)
  # =============================================================================
  # OpenRouter provides access to 100+ models from various providers.
  # Full model list: https://openrouter.ai/models
  #
  # Model format: provider/model-name
  #   Examples: anthropic/claude-3.5-sonnet, openai/gpt-4-turbo, meta-llama/llama-3-70b
  #
  # Price/Speed suffixes (append to model name):
  #   :floor  - Always pick cheapest provider (sort by price)
  #   :nitro  - Always pick fastest provider (sort by throughput)
  #   :free   - Use free tier only
  #
  # Special models:
  #   openrouter/auto - Auto-select best model based on prompt complexity
  #
  # Provider routing (set in API request):
  #   provider.sort: "price" | "latency" | "throughput"
  #   provider.order: ["anthropic", "openai"]  # prioritize specific providers
  #   provider.max_price: { prompt: 0.001, completion: 0.002 }  # USD per token

  # Auto-routing: OpenRouter picks the best model for each request
  openrouter-auto-or1a2b3c:
    name: "OpenRouter Auto"
    description: "Auto-selects best model based on prompt - smart routing"
    model: openrouter/auto
    system_prompt: |
      You are a helpful assistant powered by OpenRouter's auto-routing.
      The system automatically selects the best model for each request.

      Help users with:
      - Code writing and debugging
      - Answering questions and explaining concepts
      - File operations and navigation

      Be concise and helpful.

    subagents:
      - reviewer
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
      - Skill
      - Task
      - AskUserQuestion
      - WebFetch
      - WebSearch

  # Cheapest option: Claude Sonnet with :floor suffix (always lowest price)
  openrouter-cheap-sonnet-ch1a2b3c:
    name: "Claude Sonnet (Cheapest)"
    description: "Claude 3.5 Sonnet via cheapest provider - :floor routing"
    model: anthropic/claude-3.5-sonnet:floor
    system_prompt: |
      You are a helpful coding assistant powered by Claude 3.5 Sonnet.

      Help users with:
      - Code writing and debugging
      - Answering technical questions
      - File operations and navigation

      Be concise and helpful.

    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
      - Task
      - AskUserQuestion

  # Free model - no cost, great for testing
  openrouter-free-llama31-fr1a2b3c:
    name: "Llama 3.1 8B (Free)"
    description: "Free Meta Llama 3.1 8B via OpenRouter - zero cost"
    model: meta-llama/llama-3.1-8b-instruct:free
    system_prompt: |
      You are a helpful coding assistant powered by Llama 3.1.

      Help users with:
      - Code writing and debugging
      - Answering technical questions
      - File operations and navigation

      Be concise and helpful.

    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Grep
      - Glob
      - Task
      - AskUserQuestion
